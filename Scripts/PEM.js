Java.perform(function() {
    console.log("[*] Loading Charles PEM Certificate");
    
    var X509TrustManager = Java.use("javax.net.ssl.X509TrustManager");
    var SSLContext = Java.use("javax.net.ssl.SSLContext");
    var CertificateFactory = Java.use("java.security.cert.CertificateFactory");
    var ByteArrayInputStream = Java.use("java.io.ByteArrayInputStream");
    
    // Paste your PEM byte array here (from the Python script)
    var charlesCertBytes = [
    0x2d,0x2d,0x2d,0x2d,0x2d,0x42,0x45,0x47,0x49,0x4e,0x20,0x43,0x45,0x52,
    0x54,0x49,0x46,0x49,0x43,0x41,0x54,0x45,0x2d,0x2d,0x2d,0x2d,0x2d,0x0d,
    0x0a,0x4d,0x49,0x49,0x46,0x52,0x7a,0x43,0x43,0x42,0x43,0x2b,0x67,0x41,
    0x77,0x49,0x42,0x41,0x67,0x49,0x47,0x41,0x5a,0x6d,0x58,0x4e,0x49,0x43,
    0x37,0x4d,0x41,0x30,0x47,0x43,0x53,0x71,0x47,0x53,0x49,0x62,0x33,0x44,
    0x51,0x45,0x42,0x43,0x77,0x55,0x41,0x4d,0x49,0x47,0x6e,0x4d,0x54,0x67,
    0x77,0x4e,0x67,0x59,0x44,0x56,0x51,0x51,0x44,0x44,0x43,0x39,0x44,0x61,
    0x47,0x46,0x79,0x62,0x47,0x56,0x7a,0x0d,0x0a,0x49,0x46,0x42,0x79,0x62,
    0x33,0x68,0x35,0x49,0x45,0x4e,0x42,0x49,0x43,0x67,0x7a,0x4d,0x43,0x42,
    0x54,0x5a,0x58,0x41,0x67,0x4d,0x6a,0x41,0x79,0x4e,0x53,0x77,0x67,0x54,
    0x55,0x46,0x55,0x56,0x45,0x6c,0x42,0x55,0x79,0x31,0x4b,0x55,0x6c,0x56,
    0x4a,0x4f,0x46,0x4d,0x77,0x4b,0x54,0x45,0x6c,0x4d,0x43,0x4d,0x47,0x41,
    0x31,0x55,0x45,0x43,0x77,0x77,0x63,0x61,0x48,0x52,0x30,0x63,0x48,0x4d,
    0x36,0x0d,0x0a,0x4c,0x79,0x39,0x6a,0x61,0x47,0x46,0x79,0x62,0x47,0x56,
    0x7a,0x63,0x48,0x4a,0x76,0x65,0x48,0x6b,0x75,0x59,0x32,0x39,0x74,0x4c,
    0x33,0x4e,0x7a,0x62,0x44,0x45,0x52,0x4d,0x41,0x38,0x47,0x41,0x31,0x55,
    0x45,0x43,0x67,0x77,0x49,0x57,0x45,0x73,0x33,0x4d,0x69,0x42,0x4d,0x64,
    0x47,0x51,0x78,0x45,0x54,0x41,0x50,0x42,0x67,0x4e,0x56,0x42,0x41,0x63,
    0x4d,0x43,0x45,0x46,0x31,0x59,0x32,0x74,0x73,0x0d,0x0a,0x59,0x57,0x35,
    0x6b,0x4d,0x52,0x45,0x77,0x44,0x77,0x59,0x44,0x56,0x51,0x51,0x49,0x44,
    0x41,0x68,0x42,0x64,0x57,0x4e,0x72,0x62,0x47,0x46,0x75,0x5a,0x44,0x45,
    0x4c,0x4d,0x41,0x6b,0x47,0x41,0x31,0x55,0x45,0x42,0x68,0x4d,0x43,0x54,
    0x6c,0x6f,0x77,0x48,0x68,0x63,0x4e,0x4d,0x6a,0x55,0x77,0x4f,0x54,0x49,
    0x34,0x4d,0x6a,0x41,0x30,0x4d,0x44,0x49,0x30,0x57,0x68,0x63,0x4e,0x4d,
    0x6a,0x59,0x77,0x0d,0x0a,0x4f,0x54,0x49,0x34,0x4d,0x6a,0x41,0x30,0x4d,
    0x44,0x49,0x30,0x57,0x6a,0x43,0x42,0x70,0x7a,0x45,0x34,0x4d,0x44,0x59,
    0x47,0x41,0x31,0x55,0x45,0x41,0x77,0x77,0x76,0x51,0x32,0x68,0x68,0x63,
    0x6d,0x78,0x6c,0x63,0x79,0x42,0x51,0x63,0x6d,0x39,0x34,0x65,0x53,0x42,
    0x44,0x51,0x53,0x41,0x6f,0x4d,0x7a,0x41,0x67,0x55,0x32,0x56,0x77,0x49,
    0x44,0x49,0x77,0x4d,0x6a,0x55,0x73,0x49,0x45,0x31,0x42,0x0d,0x0a,0x56,
    0x46,0x52,0x4a,0x51,0x56,0x4d,0x74,0x53,0x6c,0x4a,0x56,0x53,0x54,0x68,
    0x54,0x4d,0x43,0x6b,0x78,0x4a,0x54,0x41,0x6a,0x42,0x67,0x4e,0x56,0x42,
    0x41,0x73,0x4d,0x48,0x47,0x68,0x30,0x64,0x48,0x42,0x7a,0x4f,0x69,0x38,
    0x76,0x59,0x32,0x68,0x68,0x63,0x6d,0x78,0x6c,0x63,0x33,0x42,0x79,0x62,
    0x33,0x68,0x35,0x4c,0x6d,0x4e,0x76,0x62,0x53,0x39,0x7a,0x63,0x32,0x77,
    0x78,0x45,0x54,0x41,0x50,0x0d,0x0a,0x42,0x67,0x4e,0x56,0x42,0x41,0x6f,
    0x4d,0x43,0x46,0x68,0x4c,0x4e,0x7a,0x49,0x67,0x54,0x48,0x52,0x6b,0x4d,
    0x52,0x45,0x77,0x44,0x77,0x59,0x44,0x56,0x51,0x51,0x48,0x44,0x41,0x68,
    0x42,0x64,0x57,0x4e,0x72,0x62,0x47,0x46,0x75,0x5a,0x44,0x45,0x52,0x4d,
    0x41,0x38,0x47,0x41,0x31,0x55,0x45,0x43,0x41,0x77,0x49,0x51,0x58,0x56,
    0x6a,0x61,0x32,0x78,0x68,0x62,0x6d,0x51,0x78,0x43,0x7a,0x41,0x4a,0x0d,
    0x0a,0x42,0x67,0x4e,0x56,0x42,0x41,0x59,0x54,0x41,0x6b,0x35,0x61,0x4d,
    0x49,0x49,0x42,0x49,0x6a,0x41,0x4e,0x42,0x67,0x6b,0x71,0x68,0x6b,0x69,
    0x47,0x39,0x77,0x30,0x42,0x41,0x51,0x45,0x46,0x41,0x41,0x4f,0x43,0x41,
    0x51,0x38,0x41,0x4d,0x49,0x49,0x42,0x43,0x67,0x4b,0x43,0x41,0x51,0x45,
    0x41,0x73,0x61,0x6a,0x7a,0x78,0x30,0x39,0x59,0x4d,0x77,0x66,0x32,0x48,
    0x63,0x5a,0x64,0x76,0x74,0x4a,0x68,0x0d,0x0a,0x6e,0x66,0x71,0x2f,0x46,
    0x41,0x67,0x54,0x7a,0x54,0x31,0x47,0x65,0x54,0x36,0x49,0x46,0x78,0x6c,
    0x37,0x6d,0x71,0x2b,0x6d,0x6e,0x43,0x77,0x5a,0x67,0x44,0x36,0x30,0x38,
    0x31,0x62,0x6f,0x37,0x41,0x30,0x61,0x7a,0x31,0x37,0x68,0x2b,0x36,0x57,
    0x6b,0x38,0x57,0x41,0x47,0x43,0x74,0x2f,0x4d,0x51,0x78,0x62,0x55,0x77,
    0x42,0x43,0x6b,0x48,0x7a,0x65,0x68,0x66,0x77,0x41,0x5a,0x2f,0x58,0x69,
    0x2f,0x0d,0x0a,0x44,0x75,0x4f,0x73,0x68,0x6b,0x4f,0x6a,0x47,0x74,0x54,
    0x7a,0x36,0x47,0x51,0x79,0x56,0x6a,0x56,0x66,0x4c,0x76,0x4f,0x72,0x33,
    0x42,0x55,0x5a,0x48,0x65,0x66,0x67,0x52,0x58,0x4d,0x56,0x41,0x64,0x78,
    0x33,0x63,0x50,0x76,0x75,0x52,0x70,0x4d,0x2b,0x2f,0x46,0x6f,0x30,0x48,
    0x59,0x62,0x59,0x56,0x65,0x35,0x41,0x5a,0x6c,0x74,0x4d,0x74,0x37,0x34,
    0x70,0x65,0x56,0x51,0x71,0x38,0x4c,0x33,0x74,0x0d,0x0a,0x6b,0x4b,0x6e,
    0x33,0x5a,0x2f,0x35,0x48,0x49,0x63,0x69,0x2b,0x6f,0x77,0x72,0x61,0x4a,
    0x63,0x36,0x4d,0x42,0x55,0x35,0x67,0x54,0x53,0x58,0x71,0x35,0x39,0x76,
    0x58,0x34,0x39,0x56,0x5a,0x62,0x33,0x35,0x33,0x47,0x6a,0x63,0x5a,0x38,
    0x53,0x75,0x61,0x4e,0x48,0x49,0x2b,0x49,0x65,0x69,0x4e,0x38,0x52,0x46,
    0x6d,0x70,0x45,0x6d,0x36,0x31,0x38,0x46,0x45,0x70,0x70,0x6f,0x6e,0x57,
    0x5a,0x4b,0x2b,0x0d,0x0a,0x64,0x69,0x34,0x6b,0x77,0x30,0x64,0x58,0x74,
    0x2f,0x44,0x48,0x56,0x41,0x57,0x47,0x52,0x73,0x30,0x2b,0x70,0x57,0x70,
    0x4d,0x2b,0x52,0x64,0x32,0x7a,0x4d,0x4a,0x46,0x57,0x2f,0x63,0x46,0x75,
    0x57,0x31,0x77,0x67,0x48,0x57,0x4b,0x41,0x30,0x32,0x45,0x59,0x56,0x2b,
    0x6c,0x4c,0x51,0x54,0x4f,0x31,0x36,0x45,0x65,0x6f,0x58,0x74,0x33,0x39,
    0x64,0x61,0x39,0x31,0x33,0x6b,0x46,0x4a,0x37,0x4a,0x6c,0x0d,0x0a,0x53,
    0x32,0x59,0x61,0x65,0x78,0x5a,0x70,0x74,0x50,0x76,0x50,0x51,0x69,0x73,
    0x4e,0x65,0x77,0x49,0x44,0x41,0x51,0x41,0x42,0x6f,0x34,0x49,0x42,0x64,
    0x54,0x43,0x43,0x41,0x58,0x45,0x77,0x44,0x77,0x59,0x44,0x56,0x52,0x30,
    0x54,0x41,0x51,0x48,0x2f,0x42,0x41,0x55,0x77,0x41,0x77,0x45,0x42,0x2f,
    0x7a,0x43,0x43,0x41,0x53,0x30,0x47,0x43,0x57,0x43,0x47,0x53,0x41,0x47,
    0x47,0x2b,0x45,0x49,0x42,0x0d,0x0a,0x44,0x51,0x53,0x43,0x41,0x52,0x34,
    0x54,0x67,0x67,0x45,0x61,0x56,0x47,0x68,0x70,0x63,0x79,0x42,0x79,0x62,
    0x32,0x39,0x30,0x49,0x47,0x4e,0x6c,0x63,0x6e,0x52,0x70,0x5a,0x6d,0x6c,
    0x6a,0x59,0x58,0x52,0x6c,0x49,0x48,0x64,0x68,0x63,0x79,0x42,0x6e,0x5a,
    0x57,0x35,0x6c,0x63,0x6d,0x46,0x30,0x5a,0x57,0x51,0x67,0x59,0x6e,0x6b,
    0x67,0x51,0x32,0x68,0x68,0x63,0x6d,0x78,0x6c,0x63,0x79,0x42,0x51,0x0d,
    0x0a,0x63,0x6d,0x39,0x34,0x65,0x53,0x42,0x6d,0x62,0x33,0x49,0x67,0x55,
    0x31,0x4e,0x4d,0x49,0x46,0x42,0x79,0x62,0x33,0x68,0x35,0x61,0x57,0x35,
    0x6e,0x4c,0x69,0x42,0x4a,0x5a,0x69,0x42,0x30,0x61,0x47,0x6c,0x7a,0x49,
    0x47,0x4e,0x6c,0x63,0x6e,0x52,0x70,0x5a,0x6d,0x6c,0x6a,0x59,0x58,0x52,
    0x6c,0x49,0x47,0x6c,0x7a,0x49,0x48,0x42,0x68,0x63,0x6e,0x51,0x67,0x62,
    0x32,0x59,0x67,0x59,0x53,0x42,0x6a,0x0d,0x0a,0x5a,0x58,0x4a,0x30,0x61,
    0x57,0x5a,0x70,0x59,0x32,0x46,0x30,0x5a,0x53,0x42,0x6a,0x61,0x47,0x46,
    0x70,0x62,0x69,0x77,0x67,0x64,0x47,0x68,0x70,0x63,0x79,0x42,0x74,0x5a,
    0x57,0x46,0x75,0x63,0x79,0x42,0x30,0x61,0x47,0x46,0x30,0x49,0x48,0x6c,
    0x76,0x64,0x53,0x64,0x79,0x5a,0x53,0x42,0x69,0x63,0x6d,0x39,0x33,0x63,
    0x32,0x6c,0x75,0x5a,0x79,0x42,0x30,0x61,0x48,0x4a,0x76,0x64,0x57,0x64,
    0x6f,0x0d,0x0a,0x49,0x45,0x4e,0x6f,0x59,0x58,0x4a,0x73,0x5a,0x58,0x4d,
    0x67,0x55,0x48,0x4a,0x76,0x65,0x48,0x6b,0x67,0x64,0x32,0x6c,0x30,0x61,
    0x43,0x42,0x54,0x55,0x30,0x77,0x67,0x55,0x48,0x4a,0x76,0x65,0x48,0x6c,
    0x70,0x62,0x6d,0x63,0x67,0x5a,0x57,0x35,0x68,0x59,0x6d,0x78,0x6c,0x5a,
    0x43,0x42,0x6d,0x62,0x33,0x49,0x67,0x64,0x47,0x68,0x70,0x63,0x79,0x42,
    0x33,0x5a,0x57,0x4a,0x7a,0x61,0x58,0x52,0x6c,0x0d,0x0a,0x4c,0x69,0x42,
    0x51,0x62,0x47,0x56,0x68,0x63,0x32,0x55,0x67,0x63,0x32,0x56,0x6c,0x49,
    0x47,0x68,0x30,0x64,0x48,0x42,0x7a,0x4f,0x69,0x38,0x76,0x59,0x32,0x68,
    0x68,0x63,0x6d,0x78,0x6c,0x63,0x33,0x42,0x79,0x62,0x33,0x68,0x35,0x4c,
    0x6d,0x4e,0x76,0x62,0x53,0x39,0x7a,0x63,0x32,0x77,0x67,0x5a,0x6d,0x39,
    0x79,0x49,0x47,0x31,0x76,0x63,0x6d,0x55,0x67,0x61,0x57,0x35,0x6d,0x62,
    0x33,0x4a,0x74,0x0d,0x0a,0x59,0x58,0x52,0x70,0x62,0x32,0x34,0x75,0x4d,
    0x41,0x34,0x47,0x41,0x31,0x55,0x64,0x44,0x77,0x45,0x42,0x2f,0x77,0x51,
    0x45,0x41,0x77,0x49,0x43,0x42,0x44,0x41,0x64,0x42,0x67,0x4e,0x56,0x48,
    0x51,0x34,0x45,0x46,0x67,0x51,0x55,0x74,0x36,0x31,0x69,0x36,0x34,0x50,
    0x63,0x32,0x48,0x54,0x54,0x2f,0x4b,0x31,0x6f,0x7a,0x5a,0x52,0x65,0x4c,
    0x2f,0x6f,0x63,0x55,0x34,0x59,0x77,0x44,0x51,0x59,0x4a,0x0d,0x0a,0x4b,
    0x6f,0x5a,0x49,0x68,0x76,0x63,0x4e,0x41,0x51,0x45,0x4c,0x42,0x51,0x41,
    0x44,0x67,0x67,0x45,0x42,0x41,0x47,0x4a,0x6c,0x33,0x2f,0x64,0x6f,0x39,
    0x54,0x4b,0x79,0x6b,0x61,0x35,0x53,0x47,0x47,0x6f,0x68,0x54,0x79,0x35,
    0x6a,0x5a,0x41,0x6a,0x72,0x38,0x36,0x4e,0x5a,0x7a,0x4e,0x76,0x7a,0x6c,
    0x71,0x58,0x78,0x4e,0x31,0x65,0x4f,0x36,0x68,0x6b,0x63,0x76,0x51,0x77,
    0x6e,0x4b,0x2b,0x30,0x47,0x0d,0x0a,0x47,0x56,0x70,0x63,0x58,0x78,0x34,
    0x51,0x57,0x31,0x45,0x6a,0x31,0x4a,0x6f,0x6b,0x5a,0x6f,0x70,0x45,0x4e,
    0x4b,0x61,0x62,0x4f,0x4a,0x51,0x70,0x54,0x51,0x36,0x6d,0x67,0x73,0x68,
    0x4c,0x63,0x6a,0x2b,0x34,0x42,0x52,0x78,0x6a,0x69,0x71,0x78,0x62,0x61,
    0x63,0x69,0x73,0x6f,0x57,0x4d,0x59,0x49,0x35,0x43,0x4d,0x72,0x41,0x54,
    0x44,0x5a,0x47,0x4a,0x69,0x5a,0x6b,0x4c,0x6b,0x55,0x46,0x32,0x6b,0x0d,
    0x0a,0x6e,0x31,0x55,0x59,0x4b,0x43,0x7a,0x41,0x46,0x31,0x6c,0x4a,0x47,
    0x5a,0x49,0x35,0x71,0x53,0x61,0x6c,0x51,0x6a,0x46,0x52,0x36,0x31,0x5a,
    0x37,0x68,0x68,0x67,0x48,0x65,0x59,0x2f,0x36,0x2b,0x38,0x69,0x4a,0x67,
    0x58,0x39,0x72,0x4d,0x78,0x68,0x6f,0x67,0x41,0x31,0x4e,0x45,0x43,0x52,
    0x43,0x56,0x32,0x6e,0x6a,0x54,0x7a,0x58,0x39,0x6d,0x50,0x68,0x73,0x6c,
    0x78,0x53,0x65,0x35,0x31,0x33,0x43,0x0d,0x0a,0x53,0x57,0x33,0x42,0x6b,
    0x47,0x33,0x65,0x55,0x35,0x4a,0x2f,0x72,0x46,0x41,0x72,0x70,0x46,0x73,
    0x2b,0x6e,0x38,0x49,0x6c,0x69,0x35,0x7a,0x52,0x4e,0x45,0x47,0x73,0x68,
    0x50,0x41,0x64,0x54,0x42,0x55,0x36,0x2f,0x63,0x76,0x5a,0x50,0x4e,0x66,
    0x2b,0x79,0x47,0x52,0x57,0x76,0x37,0x53,0x74,0x32,0x56,0x4b,0x32,0x32,
    0x51,0x72,0x76,0x63,0x6e,0x70,0x62,0x6b,0x50,0x30,0x76,0x71,0x69,0x77,
    0x6f,0x0d,0x0a,0x71,0x6f,0x42,0x48,0x74,0x45,0x6a,0x74,0x2f,0x53,0x71,
    0x56,0x61,0x48,0x4e,0x56,0x6b,0x6e,0x38,0x66,0x49,0x6a,0x57,0x51,0x71,
    0x79,0x71,0x4d,0x72,0x2b,0x69,0x41,0x52,0x31,0x56,0x75,0x5a,0x72,0x54,
    0x38,0x64,0x72,0x69,0x4b,0x69,0x70,0x76,0x49,0x75,0x79,0x62,0x66,0x78,
    0x7a,0x46,0x67,0x49,0x6d,0x63,0x3d,0x0d,0x0a,0x2d,0x2d,0x2d,0x2d,0x2d,
    0x45,0x4e,0x44,0x20,0x43,0x45,0x52,0x54,0x49,0x46,0x49,0x43,0x41,0x54,
    0x45,0x2d,0x2d,0x2d,0x2d,0x2d,0x0d,0x0a
];
    
    try {
        // Convert byte array back to PEM string
        var pemString = "";
        for (var i = 0; i < charlesCertBytes.length; i++) {
            pemString += String.fromCharCode(charlesCertBytes[i]);
        }
        
        // Remove PEM headers/footers and decode base64
        var base64Data = pemString.replace(/-----BEGIN CERTIFICATE-----/, '')
                                 .replace(/-----END CERTIFICATE-----/, '')
                                 .replace(/[\r\n]/g, '');
        
        // Convert base64 to byte array
        var binaryData = Java.use("android.util.Base64").decode(base64Data, 0);
        
        // Create certificate from DER data
        var cf = CertificateFactory.getInstance("X.509");
        var certInput = ByteArrayInputStream.$new(binaryData);
        var charlesCert = cf.generateCertificate(certInput);
        
        console.log("[+] Charles certificate loaded: " + charlesCert.getSubjectDN());
        
        // Create custom trust manager
        var customTrustManager = X509TrustManager.$new({
            checkClientTrusted: function(chain, authType) {},
            checkServerTrusted: function(chain, authType) {
                console.log("[*] Trusting: " + chain[0].getSubjectDN());
            },
            getAcceptedIssuers: function() { return []; }
        });
        
        // Install it
        var sslContext = SSLContext.getInstance("TLS");
        sslContext.init(null, [customTrustManager], null);
        SSLContext.setDefault(sslContext);
        
        console.log("[+] Charles certificate installed in trust store");
        
    } catch(e) {
        console.log("[-] Error: " + e);
    }
});